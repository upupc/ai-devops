---
name: 技术白皮书生成
description: 基于产品白皮书与代码仓生成技术规格书，保持能力ID对齐并给出可定位实现。
category: 规格
tags: [技术白皮书, 规格, 文档, 能力]
---

# 技术规格书生成指令

## BACKGROUND 背景
你将基于“产品白皮书 + 代码仓库”生成《技术规格书》。该文档用于研发/评审/AI 辅助开发的统一上下文，必须支持能力到代码的双向追溯、模型与服务边界清晰、依赖与配置可定位、异常与规则可复用。输入可能不完整，但不得凭空编造；缺失信息一律用 `[待补充]` 标注，并说明需要补充什么与影响范围。

## ROLE 角色
请扮演“双角色协作”：
1. 技术白皮书主笔：从产品白皮书能力ID出发，深度检索代码仓，提炼并结构化输出可落地的技术说明。
2. 一致性审稿人：复核能力ID对齐、章节结构、术语一致性、引用可定位性，确保输出稳定、专业、可复用。

## OBJECTIVES 目标
按照 `.claude/specs/tech-specification-paper.md` 产出高质量技术白皮书保存到 `project-artifacts/tech/tech-specification-paper.md`，并确保：
1. 与产品白皮书能力ID完全对齐（不漏、不重、不改ID含义）。
2. 每个能力点给出可定位的实现路径（文件/类/方法）与关键调用链。
3. 补齐关键上下文：参数/数据模型职责、服务边界、规则（含异常/边界）、错误码、外部依赖、关键配置。
4. 通过深度探索代码仓输出"细且对"的结论，避免粗粒度空话。

## KEY RESULT 关键结果（必须达成）
交付物需满足以下可验收结果，不满足则继续迭代补充：
- 能力对齐表：列出全部 `能力ID → 所属模块 → 功能点 → 入口类型 → 入口定位 → 核心实现定位`，且均可在代码仓检索到。
- 能力详解：每个能力点至少包含：业务简述、触发/入口、调用链表、关键参数、规则（正常/异常/边界）、关键流程图（Mermaid 可选）、错误码、外部依赖、配置（如有）。
- 第4章深度上下文（按模板第4章口径）：核心模型关系图（Domain/Entity/DTO/VO + 转换关系）、关键字段说明表、服务清单表（含边界/幂等/超时/重试）、工具/枚举/常量复用边界。
- 可验证性：所有“路径/类/方法/常量/枚举/错误码”必须可在代码仓定位；不可定位的一律标 `[待补充]` 并说明原因与补充方式。
- 粒度要求：禁止只写“调用 service 处理业务”这类泛化描述；必须下钻到关键方法与关键数据结构，给出可复用的规则与边界条件。
- 质量约束：能力实现说明必须按照编号顺序编写，不得随意打乱，不得随意跳过缺失。

## EVOLVE 试验并改进（至少使用两种，可自由组合）
1. 差距驱动迭代：先按模板产出初稿 → 对照自检清单逐条打分 → 只补最低分章节/能力点 → 循环直至通过。
2. 能力抽样深挖：先挑 3 个最核心/最复杂能力点深挖到“可改代码”的粒度（完整调用链+规则+模型+依赖）→ 沉淀写作范式 → 批量套用到其余能力点并复核一致性。
3. 反向验证：从代码入口（Controller/Job/MQ Consumer）反推业务能力与产品白皮书能力ID映射 → 发现缺口/多对一/一对多 → 在文档中显式说明映射规则并补齐遗漏。

## 输入
- 产品白皮书：默认读取 `project-artifacts/product/product-white-paper.md`（由 `templates/commands/spec-product-white-paper.md` 指令产出），包含能力ID、模块与功能点、业务规则/流程/依赖等。
- 代码仓库：当前可见仓库内容（允许深度检索与交叉验证）。

## 输出
- 严格按 `.claude/specs/tech-specification-paper.md` 生成技术白皮书；缺失信息用 `[待补充]` 标注；文末保留自检清单并确保可通过。
